import{d as P,v as A,z as a,A as s,i as h,t as g,M as N,x as b,y as k,V as E,N as Y,O as j,P as z,Q as w,B as l,R as L,S as q,L as M,T as $,U as T,W as R,X as W,C as Q,D as H}from"./BX9kVcox.js";import{D as J,V as I,a as Z,c as _,u as x,b as K}from"./DaCI28AF.js";import{s as ee,V as te,a as ae}from"./CgM0T468.js";import{S as se}from"./2Ej2vXKr.js";import{V as ne,O as oe,D as ie,a as le}from"./K8uXF1FW.js";import{_ as O}from"./DlAUqK2U.js";import{V as re,a as ce}from"./DQ7g55dD.js";import{u as de}from"./BJTjakZ4.js";import{V as U}from"./CAMln0qf.js";import{V as ue}from"./BMJBdCUz.js";import"./CYp8Y-B8.js";import"./DFbvfIGZ.js";const pe={info:1,important:2,secure:3,hardening:4,potentially:5,low:6,medium:7,high:8,critical:9},me=P({name:"VulnzTable",components:{DfRisk:J},props:{vulnz:{type:Array,required:!0,default:()=>[]}},emits:["goToDetail","goToDetailNewTab","showVulnDetails"],data(){return{headers:[{title:"Show",value:"show",align:"left"},{title:"Risk | CVSS",value:"risk",align:"left"},{title:"Title",value:"title",align:"left"},{title:"Short description",value:"description",align:"left"}]}},computed:{kbVulnerabilities(){var n,u,p,f,m,d,o,c,y,V,S,r,v;const e=[];for(const t of this.vulnz)if(((n=t==null?void 0:t.kb)==null?void 0:n.title)==="Use of Outdated Vulnerable Component"){let D=!1;for(const i of t.vulnerabilities.vulnerabilities)if((i==null?void 0:i.metadata)===null||(i==null?void 0:i.metadata)===void 0)D||(e.push({key:i==null?void 0:i.id,goToVulnId:!1,risk:i==null?void 0:i.customRiskRating,title:t.kb.title,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb}),D=!0);else{const X=(u=i==null?void 0:i.metadata)==null?void 0:u.find(C=>C.name==="dependency_name").value,G=(p=i==null?void 0:i.metadata)==null?void 0:p.find(C=>C.name==="dependency_version").value;e.push({key:i.id,goToVulnId:!0,risk:i.customRiskRating,cvssV3:i.customCvssV3BaseScore,title:`${t.kb.title} for ${X} version ${G}`,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb})}}else e.push({key:(f=t==null?void 0:t.kb)==null?void 0:f.title,goToVulnId:!1,risk:t.highestRiskRating,title:(m=t==null?void 0:t.kb)==null?void 0:m.title,securityIssue:(d=t==null?void 0:t.kb)==null?void 0:d.securityIssue,privacyIssue:(o=t==null?void 0:t.kb)==null?void 0:o.privacyIssue,targetedByMalware:(c=t==null?void 0:t.kb)==null?void 0:c.targetedByMalware,targetedByRansomware:(y=t==null?void 0:t.kb)==null?void 0:y.targetedByRansomware,targetedByNationState:(V=t==null?void 0:t.kb)==null?void 0:V.targetedByNationState,hasPublicExploit:(S=t==null?void 0:t.kb)==null?void 0:S.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:(r=t==null?void 0:t.kb)==null?void 0:r.shortDescription,descriptionFormat:(v=t==null?void 0:t.kb)==null?void 0:v.shortDescriptionFormat,kb:t.kb});return ee(e).by([{desc:t=>{var D;return pe[((D=t==null?void 0:t.risk)==null?void 0:D.toLocaleLowerCase())||""]}},{desc:t=>t.cvssV3}])}},methods:{goToDetail(e){this.$emit("goToDetail",e)},goToDetailNewTab(e){this.$emit("goToDetailNewTab",e)},showVulnDetails(e){this.$emit("showVulnDetails",e)}}}),he=["onClick","onMouseup"],fe=["onClick","onMouseup"];function ge(e,n,u,p,f,m){const d=h("DfRisk");return g(),A("div",null,[a(ne,{hover:"",headers:e.headers,items:e.kbVulnerabilities,"items-per-page":-1},{"item.risk":s(({item:o})=>[a(d,{"cvss-score":o.cvssV3,risk:o.risk,class:"cursor-pointer",onClick:c=>e.goToDetail(o),onMouseup:N(c=>e.goToDetailNewTab(o),["middle"])},null,8,["cvss-score","risk","onClick","onMouseup"])]),"item.title":s(({item:o})=>[b("div",{class:"cursor-pointer",onClick:c=>e.goToDetail(o),onMouseup:N(c=>e.goToDetailNewTab(o),["middle"])},k(o.title),41,he)]),"item.description":s(({item:o})=>[b("div",{class:"cursor-pointer",onClick:c=>e.goToDetail(o),onMouseup:N(c=>e.goToDetailNewTab(o),["middle"])},k(o.description),41,fe)]),"item.show":s(({item:o})=>[a(E,{size:"small",variant:"flat",icon:"mdi-arrow-expand",onClick:c=>e.showVulnDetails(o)},null,8,["onClick"])]),_:2},1032,["headers","items"])])}const be=O(me,[["render",ge]]),De=P({name:"VulnerabilityDetailDialog",components:{VulnerabilityDetail:te},props:{modelValue:{type:Boolean,default:!1},vuln:{type:Object,default:null},scanId:{type:Number,required:!0},scanner:{type:Object,required:!0}},emits:["update:modelValue"],data(){return{loading:!1,dialog:!1}},computed:{vulnKey(){var e;return(e=this.vuln)==null?void 0:e.key}},watch:{modelValue:{immediate:!0,handler(e){this.dialog=e}},dialog(e){this.$emit("update:modelValue",e)}}}),ke={class:"vulnerability-detail-container"};function ye(e,n,u,p,f,m){const d=h("VulnerabilityDetail");return g(),A("div",ke,[a(re,{ref:"dialogRef",modelValue:e.dialog,"onUpdate:modelValue":n[0]||(n[0]=o=>e.dialog=o),scrollable:"",attach:"",eager:"","max-width":"50%",transition:"slide-x-transition",class:"ml-auto"},{default:s(()=>[a(I,{class:"dialog-card pa-2",loading:e.loading,style:{"min-height":"100vh"}},{default:s(()=>[a(d,{"vuln-title":e.vulnKey,"scan-id":e.scanId,scanner:e.scanner,"show-breadcrumbs":!1},null,8,["vuln-title","scan-id","scanner"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}const Ve=O(De,[["render",ye]]),B=2,Se=P({name:"Index",components:{OXOAssets:oe,DfScanProgress:ie,DfConfirmationModal:le,VulnzTable:be,VunerabilityDetailDialog:Ve,DfBreadcrumbs:Z},data(){return{scanner:{endpoint:"",name:"",apiKey:""},vulnDetailsDialog:!1,selectedVulnerability:null,options:{page:1,itemsPerPage:15},vulnerabilityService:new ae(this.$axios),scanService:new se(this.$axios),kb:null,title:"",progress:"UNKNOWN",vulns:[],loadingDialog:!1,stopBtnLoading:!1,deleteScanDialog:!1,archiveBtnLoading:!1,stopScanDialog:!1,assets:[],breadcrumbs:[{text:"scanning",disabled:!0,exact:!0},{text:"scans",disabled:!1,to:"/scan/list",exact:!0},{text:"Scan",disabled:!1,to:`/scan/${this.$route.params.scan}`,exact:!0,scans:[]}]}},computed:{...Y(de,["scanners"]),scanId(){return this.$route.params.scan===void 0||this.$route.params.scan===null?(this.reportError("Scan ID not provided"),0):parseInt(this.$route.params.scan)},totalVulnerabilities(){var e;return((e=this.vulns)==null?void 0:e.length)||0}},async mounted(){const e=this.scanners.find(n=>_(n.endpoint)===this.$route.params.scanner);e===void 0?(this.reportError("Scanner not found"),this.$router.push({name:"scan-list"})):(this.scanner=e,await Promise.allSettled([this.fetchKBVulnerabilities(),this.fetchScans()]),this.updateBreadcrumbs())},methods:{...j(x,["reportError","reportInfo","reportSuccess"]),async fetchKBVulnerabilities(){try{this.loadingDialog=!0;const e=await this.vulnerabilityService.getKBVulnerabilities(this.scanner,this.scanId);this.kb=e,this.vulns=(e==null?void 0:e.kbVulnerabilities)||[],this.title=e==null?void 0:e.title,this.assets=e==null?void 0:e.assets,this.progress=e==null?void 0:e.progress}catch(e){this.reportError(`An error was encountered while fetching the scan: ${e}`)}finally{this.loadingDialog=!1}},showVulnDetails(e){this.selectedVulnerability=e,this.vulnDetailsDialog=!0},goToDetail(e){this.$router.push({name:"scan-scanner-scan-vuln-vuln",params:{scan:this.scanId,scanner:_(this.scanner.endpoint),vuln:e.key??e.kb.id}})},goToDetailNewTab(e){const n=this.$router.resolve(`/scan/${_(this.scanner.endpoint)}/${this.scanId}/vuln/${e.key??e.kb.id}`);window.open(n.href,"_blank")},async fetchScans(){this.breadcrumbs[B].scans=await this.scanService.getScans(this.scanner,{page:1,numberElements:20})},updateBreadcrumbs(){var n,u,p;((u=((n=this.breadcrumbs[B])==null?void 0:n.scans)||[])==null?void 0:u.find(f=>{var m;return f.id===((m=this.kb)==null?void 0:m.id)}))===void 0&&(this.breadcrumbs[B].scans=[...((p=this.breadcrumbs[B])==null?void 0:p.scans)||[],this.kb])},async stopScan(){try{this.stopBtnLoading=!0,await this.scanService.stopScan(this.scanner,this.scanId),await this.fetchKBVulnerabilities()}catch(e){this.reportError((e==null?void 0:e.message)||"Error Stopping scan.")}finally{this.stopBtnLoading=!1}},async deleteScan(){try{this.loadingDialog=!0,await this.scanService.deleteScan(this.scanner,this.scanId),this.reportSuccess("Scan deleted successfully"),this.$router.push("/scan/list")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e.message}`)}finally{this.loadingDialog=!1}}}}),F=e=>(Q("data-v-d8d4544a"),e=e(),H(),e),ve=F(()=>b("span",null,"Stops scan. Stopped scans can't be restarted.",-1)),we=F(()=>b("span",null,"Archives scan and removes all findings and artifacts.",-1));function $e(e,n,u,p,f,m){const d=h("DfConfirmationModal"),o=h("VunerabilityDetailDialog"),c=h("DfBreadcrumbs"),y=h("OXOAssets"),V=h("DfScanProgress"),S=h("VulnzTable");return g(),A("div",null,[a(d,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":n[0]||(n[0]=r=>e.deleteScanDialog=r),title:"Are you sure you would like to archive this scan?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.deleteScan},null,8,["modelValue","onConfirm"]),a(d,{modelValue:e.stopScanDialog,"onUpdate:modelValue":n[1]||(n[1]=r=>e.stopScanDialog=r),title:"Are you sure you would like to stop the scan?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.stopScan},null,8,["modelValue","onConfirm"]),a(o,{"model-value":e.vulnDetailsDialog,"onUpdate:modelValue":n[2]||(n[2]=r=>e.vulnDetailsDialog=r),vuln:e.selectedVulnerability,"scan-id":e.scanId,scanner:e.scanner},null,8,["model-value","vuln","scan-id","scanner"]),a(c,{"scan-id":e.scanId,breadcrumbs:e.breadcrumbs,scanner:e.scanner,class:"mb-5"},null,8,["scan-id","breadcrumbs","scanner"]),a(I,{class:"d-flex pl-3 py-3 mt-3",variant:"outlined"},{default:s(()=>[a(U,{bottom:""},{activator:s(({props:r})=>[a(E,z({disabled:e.progress==="STOPPED"||e.progress==="DONE",loading:e.stopBtnLoading,class:"mr-2"},r,{onClick:n[3]||(n[3]=v=>e.stopScanDialog=!0)}),{default:s(()=>[a(w,{start:""},{default:s(()=>[l(" mdi-stop-circle-outline ")]),_:1}),l(" Stop ")]),_:2},1040,["disabled","loading"])]),default:s(()=>[ve]),_:1}),a(U,{bottom:""},{activator:s(({props:r})=>[a(E,z({loading:e.archiveBtnLoading,class:"mr-2"},r,{onClick:n[4]||(n[4]=v=>e.deleteScanDialog=!0)}),{default:s(()=>[a(w,{start:""},{default:s(()=>[l(" mdi-delete-outline ")]),_:1}),l(" Delete ")]),_:2},1040,["loading"])]),default:s(()=>[we]),_:1})]),_:1}),a(ce,{class:"mt-4 align-stretch"},{default:s(()=>[a(ue,{cols:"12",lg:"12"},{default:s(()=>[a(I,{loading:e.loadingDialog,height:"100%",variant:"outlined"},{default:s(()=>[a(K,null,{default:s(()=>[a(w,{start:""},{default:s(()=>[l(" mdi-shield-check-outline ")]),_:1}),l(" Scan Details ")]),_:1}),a(L),a(q,null,{default:s(()=>[e.title!==null&&e.title!==""?(g(),M(T,{key:0},{default:s(()=>[a($,null,{default:s(()=>[l(" Title: "),b("span",null,k(e.title),1)]),_:1})]),_:1})):R("",!0),a(T,null,{default:s(()=>[a($,null,{default:s(()=>[l(" Targets: "),a(y,{assets:e.assets},null,8,["assets"])]),_:1})]),_:1}),a(T,null,{default:s(()=>[a($,null,{default:s(()=>[l(" Progress: "),a(V,{progress:e.progress},null,8,["progress"])]),_:1})]),_:1}),a(T,null,{default:s(()=>[e.kb!==null?(g(),M($,{key:0},{default:s(()=>[l(" Date: "),b("span",null,k(e.$moment(e.kb.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)]),_:1})):R("",!0)]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),a(I,{loading:e.loadingDialog,class:"mt-12",justify:"space-around",variant:"outlined"},{default:s(()=>[a(K,null,{default:s(()=>[a(w,{start:""},{default:s(()=>[l(" mdi-bug-outline ")]),_:1}),l(" Vulnerabilities "),e.totalVulnerabilities!==null?(g(),M(W,{key:0,size:"small",class:"ml-2"},{default:s(()=>[l(k(e.totalVulnerabilities),1)]),_:1})):R("",!0)]),_:1}),a(L),a(S,{vulnz:e.vulns,onGoToDetail:e.goToDetail,onGoToDetailNewTab:e.goToDetailNewTab,onShowVulnDetails:e.showVulnDetails},null,8,["vulnz","onGoToDetail","onGoToDetailNewTab","onShowVulnDetails"])]),_:1},8,["loading"])])}const ze=O(Se,[["render",$e],["__scopeId","data-v-d8d4544a"]]);export{ze as default};
