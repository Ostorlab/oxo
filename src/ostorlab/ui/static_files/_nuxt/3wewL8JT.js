import{u as x}from"./BJTjakZ4.js";import{Z as fe,a2 as ge,c as _,a4 as u,aU as he,at as ve,a9 as Se,z as a,ae as P,P as V,R as U,d as X,N as Y,O as be,v as y,A as o,i as f,t as l,X as ye,B as m,y as b,aV as De,V as j,S as Pe,aD as q,L as D,x as Te,Q as Ve,T as ke,U as Ce,W as _e}from"./BX9kVcox.js";import{c as we,u as Ae,V as z,b as W,a as Be,d as $e}from"./DaCI28AF.js";import{S as Ee}from"./2Ej2vXKr.js";import{m as Ie,b as Oe,c as Le,d as Ne,e as Re,f as Me,g as Ge,u as Fe,p as He,h as xe,i as Ue,j as Xe,k as Ye,l as je,n as qe,o as R,q as M,r as G,s as F,O as ze,D as We,a as Qe}from"./K8uXF1FW.js";import{_ as Q}from"./DlAUqK2U.js";import{S as Ze}from"./DZNpTO_H.js";import{a as Je}from"./DQ7g55dD.js";import{V as H}from"./BMJBdCUz.js";import"./DFbvfIGZ.js";import"./CAMln0qf.js";const Ke=fe({itemsLength:{type:[Number,String],required:!0},...Ie(),...Oe(),...Le()},"VDataTableServer"),et=ge()({name:"VDataTableServer",props:Ke(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,n){let{attrs:k,slots:t}=n;const{groupBy:p}=Ne(e),{sortBy:d,multiSort:g,mustSort:h}=Re(e),{page:c,itemsPerPage:s}=Me(e),r=_(()=>parseInt(e.itemsLength,10)),{columns:v,headers:w}=Ge(e,{groupBy:p,showSelect:u(e,"showSelect"),showExpand:u(e,"showExpand")}),{items:T}=Fe(e,v),{toggleSort:A}=He({sortBy:d,multiSort:g,mustSort:h,page:c}),{opened:Z,isGroupOpen:J,toggleGroup:K,extractRows:ee}=xe({groupBy:p,sortBy:d}),{pageCount:te,setItemsPerPage:ae}=Ue({page:c,itemsPerPage:s,itemsLength:r}),{flatItems:B}=Xe(T,p,Z),{isSelected:se,select:oe,selectAll:ne,toggleSelect:re,someSelected:ie,allSelected:le}=Ye(e,{allItems:T,currentPage:T}),{isExpanded:ce,toggleExpand:de}=je(e),$=_(()=>ee(T.value));qe({page:c,itemsPerPage:s,sortBy:d,groupBy:p,search:u(e,"search")}),he("v-data-table",{toggleSort:A,sortBy:d}),ve({VDataTableRows:{hideNoData:u(e,"hideNoData"),noDataText:u(e,"noDataText"),loading:u(e,"loading"),loadingText:u(e,"loadingText")}});const i=_(()=>({page:c.value,itemsPerPage:s.value,sortBy:d.value,pageCount:te.value,toggleSort:A,setItemsPerPage:ae,someSelected:ie.value,allSelected:le.value,isSelected:se,select:oe,selectAll:ne,toggleSelect:re,isExpanded:ce,toggleExpand:de,isGroupOpen:J,toggleGroup:K,items:$.value.map(C=>C.raw),internalItems:$.value,groupedItems:B.value,columns:v.value,headers:w.value}));Se(()=>{const C=R.filterProps(e),ue=M.filterProps(e),me=G.filterProps(e),pe=F.filterProps(e);return a(F,V({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},pe),{top:()=>{var S;return(S=t.top)==null?void 0:S.call(t,i.value)},default:()=>{var S,E,I,O,L,N;return t.default?t.default(i.value):a(P,null,[(S=t.colgroup)==null?void 0:S.call(t,i.value),!e.hideDefaultHeader&&a("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[a(M,V(ue,{sticky:e.fixedHeader}),t)]),(E=t.thead)==null?void 0:E.call(t,i.value),!e.hideDefaultBody&&a("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(I=t["body.prepend"])==null?void 0:I.call(t,i.value),t.body?t.body(i.value):a(G,V(k,me,{items:B.value}),t),(O=t["body.append"])==null?void 0:O.call(t,i.value)]),(L=t.tbody)==null?void 0:L.call(t,i.value),(N=t.tfoot)==null?void 0:N.call(t,i.value)])},bottom:()=>t.bottom?t.bottom(i.value):!e.hideDefaultFooter&&a(P,null,[a(U,null,null),a(R,C,{prepend:t["footer.prepend"]})])})})}}),tt=[{title:"Target",align:"left",sortable:!1,key:"asset"},{title:"Title",align:"left",sortable:!1,key:"title"},{title:"Created time (UTC)",align:"left",sortable:!1,key:"CreatedTime"},{title:"Progress",align:"left",sortable:!1,key:"Progress"},{title:"Actions",align:"left",sortable:!1,key:"Action"}],at=X({components:{OXOAssets:ze,DfScanProgress:We,DfConfirmationModal:Qe},props:{scanner:{type:Object,required:!0}},data(){return{service:new Ee(this.$axios),scans:[],loading:!0,options:{itemsPerPage:15,page:1,sortDesc:[!0],sortBy:[{key:"CreatedTime",order:"desc"}]},onActionScan:null,stopDialog:!1,headers:tt,currentPage:0}},computed:{...Y(x,["scanners"]),actions(){return[{title:"Stop",action:this.stopScan,icon:"mdi-stop",disabled(e){return!(e.progress==="IN_PROGRESS"||e.progress==="NOT_STARTED")}},{divider:!0},{title:"Delete",action:this.deleteScan,icon:"mdi-delete"}]}},watch:{options:{handler(){this.fetchScans()},deep:!0}},methods:{...be(Ae,["reportSuccess","reportError"]),goToScan(e,n){this.$router.push({name:"scan-scanner-scan",params:{scan:n.item.id,scanner:we(this.scanner.endpoint)}})},async confirmStop(){this.onActionScan===null||this.onActionScan===void 0||(await this.service.stopScan(this.scanner,parseInt(this.onActionScan.id)),this.onActionScan=null,await this.fetchScans())},stopScan(e){this.onActionScan=e,this.stopDialog=!0},async deleteScan(e){this.loading=!0;try{await this.service.deleteScan(this.scanner,parseInt(e.id)),this.reportSuccess("Scan deleted successfully")}catch(n){this.reportError(`An error occurred while deleting the scan: ${n.message}`)}finally{this.loading=!1}await this.fetchScans()},async fetchScans(){this.loading=!0;try{if(!this.scanner)return;this.scans=await this.service.getScans(this.scanner,{numberElements:this.options.itemsPerPage,page:this.options.page})}catch(e){this.reportError(`An error occurred while fetching scans from: ${this.scanner.name||this.scanner.endpoint}: ${e.message}`)}finally{this.loading=!1}}}}),st={class:"d-flex align-center"};function ot(e,n,k,t,p,d){const g=f("DfConfirmationModal"),h=f("DfScanProgress"),c=f("OXOAssets");return l(),y("div",null,[a(g,{modelValue:e.stopDialog,"onUpdate:modelValue":n[0]||(n[0]=s=>e.stopDialog=s),title:"Are you sure you would like to stop the scan?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.confirmStop},null,8,["modelValue","onConfirm"]),a(z,{variant:"outlined",class:"pa-2"},{default:o(()=>[a(W,{class:"pa-0"},{default:o(()=>[a(ye,{label:""},{default:o(()=>[m(b(e.scanner.name||e.scanner.endpoint),1)]),_:1})]),_:1}),a(et,{options:e.options,"onUpdate:options":n[1]||(n[1]=s=>e.options=s),hover:"",headers:e.headers,items:e.scans,"items-length":e.service.totalScans,loading:e.loading,"items-per-page-options":[15,50,200,-1],"items-per-page":e.options.itemsPerPage,"onClick:row":e.goToScan},{"item.Progress":o(({item:s})=>[a(h,{progress:s.progress||"unknown"},null,8,["progress"])]),"item.CreatedTime":o(({item:s})=>[m(b(e.$moment(s.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)]),"item.Action":o(({item:s})=>[a(De,{bottom:"",left:"","offset-y":""},{activator:o(({props:r})=>[a(j,V({icon:"mdi-dots-vertical"},r,{variant:"flat",size:"small"}),null,16)]),default:o(()=>[a(Pe,{density:"compact"},{default:o(()=>[(l(!0),y(P,null,q(e.actions,(r,v)=>(l(),y(P,null,[r.divider!==void 0?(l(),D(U,{key:`divider-${v}`,class:"mb-2 mt-2"})):(l(),D(Ce,{key:`item-${v}`,density:"compact",disabled:r.disabled?r.disabled(s):!1,onClick:w=>r.action&&r.action(s)},{default:o(()=>[Te("div",st,[a(Ve,{start:""},{default:o(()=>[m(b(r.icon),1)]),_:2},1024),a(ke,null,{default:o(()=>[m(b(r.title),1)]),_:2},1024)])]),_:2},1032,["disabled","onClick"]))],64))),256))]),_:2},1024)]),_:2},1024)]),"item.asset":o(({item:s})=>[a(c,{assets:s.assets||[]},null,8,["assets"])]),"item.title":o(({item:s})=>[m(b(s.title||"-"),1)]),_:2},1032,["options","headers","items","items-length","loading","items-per-page","onClick:row"])]),_:1})])}const nt=Q(at,[["render",ot]]),rt=X({components:{ScanList:nt,DfBreadcrumbs:Be,SvgLoader:Ze},data(){return{loading:!0,breadcrumbs:[{text:"Scanning",disabled:!0,exact:!0},{text:"Scans",to:"/scan/list",exact:!0}]}},computed:{...Y(x,["scanners"])},mounted(){this.loading=!1}});function it(e,n,k,t,p,d){const g=f("DfBreadcrumbs"),h=f("SvgLoader"),c=f("scan-list");return l(),y("div",null,[a(g,{breadcrumbs:e.breadcrumbs,class:"mb-5"},null,8,["breadcrumbs"]),a(Je,{justify:"center"},{default:o(()=>[e.loading===!0?(l(),D(h,{key:0})):e.loading===!1&&e.scanners.length>0?(l(!0),y(P,{key:1},q(e.scanners,s=>(l(),D(H,{key:s.endpoint,cols:"12"},{default:o(()=>[a(c,{scanner:s},null,8,["scanner"])]),_:2},1024))),128)):e.loading===!1&&e.scanners.length===0?(l(),D(H,{key:2,content:"center",cols:"6","align-self":"center"},{default:o(()=>[a(z,{variant:"outlined"},{default:o(()=>[a(W,null,{default:o(()=>[m("No scanners found")]),_:1}),a($e,null,{default:o(()=>[a(j,{variant:"elevated",color:"primary",to:"/scanners"},{default:o(()=>[m(" Add Scanner ")]),_:1})]),_:1})]),_:1})]),_:1})):_e("",!0)]),_:1})])}const bt=Q(rt,[["render",it]]);export{bt as default};
